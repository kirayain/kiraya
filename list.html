<!DOCTYPE html>
<html lang="en-IN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>List Item | Kiraya</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .form-animate { opacity: 0; transform: translateY(20px); transition: all 0.6s ease-out; }
        .form-animate.show { opacity: 1; transform: translateY(0); }
        .toast { position: fixed; bottom: 20px; right: 20px; background: #10b981; color: white; padding: 16px 24px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); transform: translateX(120%); transition: transform 0.4s ease; z-index: 1000; font-weight: 600; }
        .toast.show { transform: translateX(0); }
    </style>
</head>
<body class="min-h-screen">

    <header class="bg-white shadow-lg sticky top-0 z-20">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <a href="index.html" class="text-3xl font-bold text-blue-700">Kiraya</a>
            <a href="browse.html" class="text-blue-600 hover:underline">Browse</a>
        </div>
    </header>

    <main class="max-w-3xl mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold text-center mb-8 form-animate">List Your Item (1 per phone)</h1>

        <form id="listingForm" class="bg-white p-8 rounded-2xl shadow-xl space-y-6 form-animate">
            <div>
                <label class="block text-sm font-semibold mb-2">Phone Number *</label>
                <input type="tel" id="ownerPhone" required pattern="[0-9]{10}" placeholder="9876543210" class="w-full px-4 py-3 border rounded-xl">
                <p class="text-xs text-red-600 mt-1">Only 1 listing allowed per phone</p>
            </div>

            <input type="text" id="ownerName" required placeholder="Your Name" class="w-full px-4 py-3 border rounded-xl">
            <input type="email" id="ownerEmail" required placeholder="Email" class="w-full px-4 py-3 border rounded-xl">
            <input type="text" id="city" required placeholder="City" class="w-full px-4 py-3 border rounded-xl">
            <input type="text" id="pincode" required pattern="[0-9]{6}" placeholder="Pincode" class="w-full px-4 py-3 border rounded-xl">
            <select id="itemType" required class="w-full px-4 py-3 border rounded-xl">
                <option value="">Item Type</option>
                <option value="car">Car</option>
                <option value="bike">Bike</option>
                <option value="house">House</option>
                <option value="games">Games</option>
                <option value="other">Other</option>
            </select>
            <input type="text" id="itemName" required placeholder="Item Name" class="w-full px-4 py-3 border rounded-xl">
            <textarea id="description" rows="3" required placeholder="Description" class="w-full px-4 py-3 border rounded-xl"></textarea>
            <input type="number" id="price" required min="50" placeholder="Price per day (â‚¹)" class="w-full px-4 py-3 border rounded-xl">
            <input type="file" id="itemImage" accept="image/*" required class="block w-full text-sm file:mr-4 file:py-3 file:px-4 file:rounded-full file:border-0 file:bg-blue-50 file:text-blue-700">
            <img id="imagePreview" src="" alt="" class="mt-3 w-full max-w-xs h-48 object-cover rounded-xl hidden">

            <input type="password" id="deletePassword" required pattern="[0-9]{6}" maxlength="6" placeholder="6-Digit Delete Password" class="w-full px-4 py-3 border rounded-xl">
            <p class="text-xs text-red-600">Required to remove listing later</p>

            <button type="submit" class="w-full bg-blue-700 text-white py-4 rounded-xl font-bold text-lg">List Item</button>
        </form>
    </main>

    <div id="toast" class="toast">Success! Redirecting...</div>

    <script>
        document.getElementById('listingForm').onsubmit = (e) => {
            e.preventDefault();
            const phone = document.getElementById('ownerPhone').value.trim();
            if (!/^\d{10}$/.test(phone)) return alert('Enter valid 10-digit phone');

            const listings = JSON.parse(localStorage.getItem('kirayaListings')) || [];
            if (listings.some(i => i.ownerPhone === phone)) {
                return alert('You already have a listing! Only 1 allowed per phone.');
            }

            const file = document.getElementById('itemImage').files[0];
            if (!file) return alert('Upload image');

            const reader = new FileReader();
            reader.onload = () => {
                const item = {
                    ownerName: document.getElementById('ownerName').value.trim(),
                    ownerPhone: phone,
                    ownerEmail: document.getElementById('ownerEmail').value.trim(),
                    city: document.getElementById('city').value.trim(),
                    pincode: document.getElementById('pincode').value.trim(),
                    type: document.getElementById('itemType').value,
                    name: document.getElementById('itemName').value.trim(),
                    description: document.getElementById('description').value.trim(),
                    price: document.getElementById('price').value,
                    image: reader.result,
                    deletePassword: document.getElementById('deletePassword').value,
                    timestamp: Date.now(),
                    id: Date.now() + Math.random()
                };

                listings.push(item);
                localStorage.setItem('kirayaListings', JSON.stringify(listings));
                localStorage.setItem('lastListedItemId', item.id);

                document.getElementById('toast').classList.add('show');
                setTimeout(() => location.href = 'browse.html', 1500);
            };
            reader.readAsDataURL(file);
        };

        document.getElementById('itemImage').onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const prev = document.getElementById('imagePreview');
                    prev.src = ev.target.result;
                    prev.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        };

        setTimeout(() => document.querySelectorAll('.form-animate').forEach((el, i) => {
            setTimeout(() => el.classList.add('show'), i * 100);
        }), 100);
    </script>
</body>
</html>
